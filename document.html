---
layout: default
---

  <div class="content">
    <h1>Document</h1>

     <div class="desc">
      <p>
       Documents are instances of <a href="collection">Collections</a>.
     </p>
    </div>

     <div class="note">
      Document fields usually start with a "<u>$</u>" so that the Tyranid fields do not conflict with the underlying data being modeled.
    </div>

     <article id="$asOf">
       <b class="method"></b>
       <b class="server"></b>
       <span class="sig">$asOf(<i>date</i>): void</span>
       <p>This rolls back the object in-place to the given date if its collection supports <a href="/#historical">historical data</a>.</p>
       <p><u>date</u> can be either an instance of Date or the number of UTC milliseconds (<u><i>Date</i>.getTime()</u>).</p>
       <p>Note that once a document is rolled back to an earlier date the document is essentially read-only as updating it in the past
         does not make sense.  Tyranid will mark the document as <a href="document#$historical"><u>$historical</u></a> which will prevent calls like
         <a href="#$save"><u>$save</u></a> from being used on it.</p>
     </article>

     <article id="$clone">
       <b class="method"></b>
       <b class="server"></b>
       <b class="client"></b>
       <span class="sig">$clone(): <a href="document">Document</a></span>
       <p>This performs a deep in-memory clone of the current document that also retains the class into the cloned document.</p>
     </article>

     <article id="$copy">
       <b class="method"></b>
       <b class="server"></b>
       <span class="sig">$copy(obj, keys: (string[] | Tyr.$all)?): void</span>
       <p>This copies values from <u>obj</u> into the current object.  If the target object has <a href="/#historical">historical</a> properties like
         <a href="#_history"><u>_history</u></a> or <a href="#$orig"><u>$orig</u></a> these will not be copied.</p>
       <p>If the <u>keys</u> parameter is:
         <ul>
           <li><b>a string array</b>, then only the properties specified in the array will be copied.  If a key is specified that exists
               in the current document but not in <u>obj</u>, then it will be deleted from the current document.</p>
           <li><b><u>Tyr.$all</u></b>, then all properties of this collection are expected to be contained in <u>obj</u>.  Any missing
         will be deleted.  This is effectively a replace.  Also see <a href="#$replace"><u>$replace()</u></a>.
     </article>

     <article id="$historical">
       <b class="property"></b>
       <b class="server"></b>
       <span class="sig">$historical: boolean</span>
       <p>This indicates that this is a read-only document that is a <a href="/#historical">historical</a> version of another document
        created using <a href="document#$asOf"><u>$asOf</u></a>.</p>
     </article>

     <article id="_history">
       <b class="property"></b>
       <b class="server"></b>
       <b class="client"></b>
       <span class="sig">_history: <a href="#snapshot">snapshot</a>[]</span>
       <p>If <a href="/#historical">historical data</a> is enabled for this collection, then this field will contain an array of historical snapshots
         for this document.</p>
       <p id="snapshot">
         The format of each <i>snapshot</i> document is:

       <table class="def">
<thead>
  <tr><th>Object Structure<th>Note<th>Type<th>Notes
</thead>
<tr><td>{</td>
<tr><td>  a:<td>Author<td><a href="/#uids">UID</a><td>A UID referencing the author of the change.
<tr><td>  c:<td>Comment<td>String<td>An optional comment about the change.
<tr><td>  o:<td>On<td><i>Date in UTC ms</i><td>The date this snapshot was taken (from <i>Date</i>.getTime()).
<tr><td>  p:<td><a href="diff#patchFormat">Patch</a><td><i>patch</i><td>The <a href="diff#patchFormat">patch object</a> containing the differences.
<tr><td>}</td>
</table>
       </p>
       <p>Users of Tyranid do not usually need to work with this history property directly.</p>
       <p>Also, if you are using historical data, do not have a field named "history" as Tyranid will overwrite it with this array.</p>
     </article>

     <article id="$id">
       <b class="property"></b>
       <b class="server"></b>
       <b class="client"></b>
       <span class="sig">$id: <i>id type</i></span>
       <p>This returns the id for this document.  This is usually (but not always) the contents of <u>_id</u>.
     </article>

     <article id="$insert">
       <b class="method"></b>
       <b class="server"></b>
       <b class="async"></b>
       <span class="sig">$insert(options: <a href="collection#options">Options</a>?): <a href="document">Document</a></span>
     </article>

     <article id="$label">
       <b class="property"></b>
       <b class="server"></b>
       <b class="client"></b>
       <span class="sig">$label: string</span>
       <p>This returns the label for this document.  See <a href="/#labels">labels</a>.
     </article>

     <article id="$model">
       <b class="property"></b>
       <b class="server"></b>
       <b class="client"></b>
       <span class="sig">$model: <a href="collection">Collection</a></span>
       <p>This is a reference to the collection of this document.  <u>this.$model</u> is equivalent to <u>this.constructor</u>.
     </article>

     <article id="$orig">
       <b class="property"></b>
       <b class="server"></b>
       <span class="sig">$orig: object</span>
       <p>This will contain all of the original values for the document if <a href="/#historical">historical data</a> is enabled for this collection.</p>
     </article>

     <article id="$populate">
       <b class="method"></b>
       <b class="server"></b>
       <b class="async"></b>
       <span class="sig">$populate(fields, <a href="/#denormalization">denormal</a>: boolean): this</span>
       <p>
         This is equivalent to <u>doc.$model.<a href="collection#populate">populate(fields, doc, denormal)</a></u>.
       </p>
       <p>
        Also see <a href="/#population">Population</a> for more information and examples.
      </p>
     </article>

     <article id="$remove">
       <b class="method"></b>
       <b class="server"></b>
       <b class="async"></b>
       <span class="sig">$remove(options: <a href="collection#options">Options</a>?): void</span>
       <p>This removes the current document from the database.</p>
     </article>

     <article id="$replace">
       <b class="method"></b>
       <b class="server"></b>
       <span class="sig">$replace(obj): void</span>
       <p>This is a short-cut for <a href="#$copy"><u>$copy(obj, Tyr.$all)</u></a>.
     </article>

     <article id="$save">
       <b class="method"></b>
       <b class="server"></b>
       <b class="client"></b>
       <b class="async"></b>
       <span class="sig">$save(options: <a href="collection#options">Options</a>?): <a href="document">Document</a></span>
       <p>This method will either update or insert the object based on whether it has an _id.</p>
       <p>When updating, the entire object is <b>replaced</b>.  See <a href="document#$update"><u>$update()</u></a> to only update instead of replace.</p>
       <p>If the document ends up being inserted, the document returned by this method will have its <u>_id</u> set.
     </article>

     <article id="$snapshot">
       <b class="method"></b>
       <b class="server"></b>
       <span class="sig">$snapshot(updateHistory: boolean, options: <a href="collection#options">Options</a>?): <a href="#snapshot">snapshot</a></span>
       <p>This <a href="/#historical">historical data</a> method compares the <a href="#$orig"><u>$orig</u></a> property and the current
         state of the object and returns a <a href="#snapshot">snapshot</a> record.</p>
       <p>If <u>updateHistory</u> is true, the <a href="#_history"><u>_history</u></a> property is expected to be present it will be updated in memory.
         Otherwise you are expected to insert the <a href="#snapshot">snapshot</a> returned into the <u>_history</u> property yourself.</p>
       <p>After the snapshot is taken, the object's current <u>$orig</u> property is updated to the current values of the object (so you can make
         more changes and then do another <u>$snapshot()</u>.</p>
       <p>Historical options like <a href="collection#options"><u>author</u></a> and <a href="collection#options"><u>comment</u></a> are supported.</p>
       <p>This method does not update the database.</p>
     </article>

     <article id="$toClient">
       <b class="method"></b>
       <b class="server"></b>
       <span class="sig">$toClient(): object</span>
       <p>
        This creates a new POJO out of this document.  Values are copied by reference (not deep-cloned!).
       </p>
     </article>

     <article id="$uid">
       <b class="property"></b>
       <b class="server"></b>
       <b class="client"></b>
       <span class="sig">$uid: string</span>
       <p>This returns the <a href="/#uids">UID</a> for this document.</p>
     </article>

     <article id="$update">
       <b class="method"></b>
       <b class="server"></b>
       <b class="async"></b>
       <span class="sig">$update(options: <a href="collection#options">Options</a>?)</span>
       <p>This updates the server document with the values in this object.  Note that the document is <i>not</i> replaced.  See
         <a href="document#$save"><u>$save()</u></a> if you want to do a full replace.</p>
       <p>This method is a short-cut for <a href="collection#updateDoc"><u><i>Collection</i>.updateDoc()</u></a>.</p>
     </article>

     <article id="$validate">
       <b class="method"></b>
       <b class="server"></b>
       <span class="sig">$validate(): <a href="validationError">ValidationError</a>[]</span>
       <p>This validates the current document according to the validation rules specified by the metadata for this collection.</p>
     </article>

  </div>
